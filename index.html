<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cloud-Native Map</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-alt: #111c36;
      --card: #1e293b;
      --card-alt: #15213a;
      --text: #e2e8f0;
      --text-muted: #94a3b8;
      --accent: #38bdf8;
      --accent-muted: rgba(56, 189, 248, 0.2);
      --border: rgba(148, 163, 184, 0.2);
      --shadow: 0 18px 40px rgba(15, 23, 42, 0.35);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top left, #1e40af 0%, #0f172a 45%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .hero {
      padding: 64px 8vw 48px;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 10% 20%, rgba(56, 189, 248, 0.35), transparent 55%),
                  radial-gradient(circle at 90% 10%, rgba(14, 165, 233, 0.3), transparent 60%),
                  radial-gradient(circle at 70% 80%, rgba(20, 184, 166, 0.25), transparent 65%);
      opacity: 0.9;
      pointer-events: none;
    }

    .hero-content {
      position: relative;
      max-width: 960px;
      z-index: 1;
    }

    .hero h1 {
      font-size: clamp(2.5rem, 4vw, 3.5rem);
      font-weight: 700;
      margin: 0 0 16px;
      letter-spacing: -0.02em;
    }

    .hero p {
      margin: 0;
      max-width: 720px;
      font-size: 1.05rem;
      line-height: 1.7;
      color: var(--text-muted);
    }

    main {
      flex: 1;
      padding: 0 8vw 120px;
    }

    .stats-grid {
      display: grid;
      gap: 24px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      margin-top: -72px;
      position: relative;
      z-index: 2;
    }

    .stat-card {
      background: linear-gradient(160deg, rgba(30, 64, 175, 0.6), rgba(15, 23, 42, 0.85));
      border: 1px solid rgba(59, 130, 246, 0.3);
      padding: 28px;
      border-radius: 18px;
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
    }

    .stat-card span {
      display: block;
    }

    .stat-value {
      font-size: 2.25rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .stat-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.75rem;
      color: rgba(226, 232, 240, 0.7);
    }

    .layers-section {
      margin-top: 72px;
    }

    .layers-section h2 {
      font-size: 1.75rem;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .layers-section h2::before {
      content: '';
      width: 36px;
      height: 4px;
      background: linear-gradient(90deg, rgba(56, 189, 248, 0.9), transparent);
      border-radius: 999px;
    }

    .hp-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .hp-card {
      border-radius: 18px;
      border: 1px solid var(--border);
      background: linear-gradient(155deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
      padding: 22px 24px;
      position: relative;
      cursor: pointer;
      transition: transform 180ms ease, border-color 180ms ease, box-shadow 180ms ease;
    }

    .hp-card:hover, .hp-card:focus-visible {
      transform: translateY(-4px);
      border-color: rgba(56, 189, 248, 0.6);
      box-shadow: 0 18px 32px rgba(8, 47, 73, 0.45);
      outline: none;
    }

    .hp-title {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0 0 8px;
    }

    .hp-meta {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .hp-card button.hp-toggle {
      all: unset;
      display: block;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .subpractice-list {
      margin-top: 20px;
      border-top: 1px solid rgba(148, 163, 184, 0.15);
      padding-top: 16px;
      display: grid;
      gap: 12px;
    }

    .sub-item {
      background: var(--card);
      border-radius: 16px;
      padding: 16px 18px;
      border: 1px solid rgba(148, 163, 184, 0.1);
      transition: border-color 150ms ease;
    }

    .sub-item:hover {
      border-color: rgba(56, 189, 248, 0.45);
    }

    .sub-item button {
      all: unset;
      display: block;
      cursor: pointer;
    }

    .sub-headline {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      margin-bottom: 6px;
      letter-spacing: -0.01em;
    }

    .index-pill {
      font-size: 0.75rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      background: var(--accent-muted);
      color: var(--accent);
      padding: 4px 10px;
      border-radius: 999px;
    }

    .sub-desc {
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.55;
    }

    .optional-tag {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 8px;
      background: rgba(244, 114, 182, 0.18);
      color: rgba(244, 114, 182, 0.9);
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(2, 6, 23, 0.75);
      backdrop-filter: blur(6px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: clamp(24px, 5vw, 48px);
      z-index: 40;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 24px;
      padding: clamp(24px, 3vw, 42px);
      width: min(720px, 100%);
      max-height: 90vh;
      overflow: hidden;
      border: 1px solid rgba(56, 189, 248, 0.2);
      box-shadow: 0 30px 80px rgba(8, 47, 73, 0.55);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .modal-header {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .modal-body {
      overflow-y: auto;
      padding-right: 6px;
      display: grid;
      gap: 24px;
    }

    .modal-section h3 {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(148, 163, 184, 0.8);
      margin-bottom: 10px;
    }

    .qa-list {
      display: grid;
      gap: 12px;
    }

    .qa-item {
      background: var(--card-alt);
      border-radius: 14px;
      padding: 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.16);
    }

    .qa-name {
      font-weight: 600;
      margin-bottom: 6px;
      color: rgba(94, 234, 212, 0.9);
      letter-spacing: 0.03em;
      text-transform: uppercase;
      font-size: 0.85rem;
    }

    .qa-rationale {
      color: var(--text-muted);
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .tools-list {
      display: grid;
      gap: 12px;
    }

    .tool-item {
      padding: 14px 16px;
      border-radius: 14px;
      background: var(--card-alt);
      border: 1px solid rgba(148, 163, 184, 0.16);
    }

    .tool-item a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }

    .tool-item a:hover {
      text-decoration: underline;
    }

    .tool-ref {
      margin-top: 6px;
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.7);
      line-height: 1.55;
    }

    .close-btn {
      background: rgba(148, 163, 184, 0.16);
      border: 1px solid rgba(148, 163, 184, 0.25);
      color: var(--text);
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.85rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background 120ms ease, transform 120ms ease;
    }

    .close-btn:hover {
      background: rgba(148, 163, 184, 0.28);
      transform: translateY(-1px);
    }

    .loading, .error-message {
      margin: 120px auto;
      text-align: center;
      color: var(--text-muted);
      max-width: 420px;
      line-height: 1.7;
    }

    .error-message strong {
      color: #fca5a5;
    }

    @media (max-width: 720px) {
      .hero {
        padding: 56px 6vw 48px;
      }

      main {
        padding: 0 6vw 96px;
      }

      .stats-grid {
        margin-top: -48px;
        gap: 18px;
      }

      .hp-grid {
        grid-template-columns: 1fr;
      }

      .modal {
        padding: 22px;
      }
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="hero-content">
      <h1>Cloud-Native Map of Practices, Tools, and Quality Attributes</h1>
      <p>
        Explore the curated landscape of cloud-native capabilities. Navigate layers, high-level practices,
        and detailed sub-practices to understand the quality attributes they influence and the tooling that supports them.
      </p>
    </div>
  </header>
  <main>
    <section class="stats-grid" id="stats">
      <article class="stat-card">
        <span class="stat-value" id="hp-count">--</span>
        <span class="stat-label">High-Level Practices</span>
      </article>
      <article class="stat-card">
        <span class="stat-value" id="subpractice-count">--</span>
        <span class="stat-label">Sub-Practices Catalogued</span>
      </article>
      <article class="stat-card">
        <span class="stat-value" id="tool-count">--</span>
        <span class="stat-label">Supporting Tools</span>
      </article>
      <article class="stat-card">
        <span class="stat-value" id="qa-count">--</span>
        <span class="stat-label">Quality Attributes Tracked</span>
      </article>
    </section>

    <div id="loading" class="loading">Loading the cloud-native map…</div>
    <div id="error" class="error-message" hidden></div>

    <section id="layers" aria-live="polite"></section>
  </main>

  <div class="modal-backdrop" id="subpractice-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal">
      <div class="modal-header">
        <div>
          <div class="index-pill" id="modal-index"></div>
          <h2 class="modal-title" id="modal-title"></h2>
        </div>
        <button class="close-btn" id="modal-close" type="button">Close</button>
      </div>
      <p class="sub-desc" id="modal-description"></p>
      <div class="modal-body">
        <section class="modal-section" id="modal-qas-section">
          <h3>Quality Attributes Affected</h3>
          <div class="qa-list" id="modal-qas"></div>
        </section>
        <section class="modal-section" id="modal-tools-section">
          <h3>Supporting Tools</h3>
          <div class="tools-list" id="modal-tools"></div>
        </section>
      </div>
    </div>
  </div>

  <script>
    const state = {
      practices: null,
      qas: null,
      tools: null,
      layers: null,
      qasByIndex: new Map(),
      toolsByIndex: new Map(),
    };

    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const layersContainer = document.getElementById('layers');

    async function loadData() {
      try {
        const [practicesRes, qasRes, toolsRes, layersRes] = await Promise.all([
          fetch('practices.json'),
          fetch('practice_QAs.json'),
          fetch('tools.json'),
          fetch('layers.json')
        ]);

        const responses = [practicesRes, qasRes, toolsRes, layersRes];
        responses.forEach((res, idx) => {
          if (!res.ok) {
            throw new Error(`Failed to fetch resource #${idx + 1}: ${res.status}`);
          }
        });

        const [practices, qas, tools, layers] = await Promise.all(responses.map(res => res.json()));

        state.practices = practices;
        state.qas = qas;
        state.tools = tools;
        state.layers = layers;

        buildIndices();
        renderStats();
        renderLayers();

        loadingEl.style.display = 'none';
      } catch (err) {
        console.error(err);
        loadingEl.style.display = 'none';
        errorEl.hidden = false;
        errorEl.innerHTML = `<strong>We hit a snag.</strong><br/>${err.message}`;
      }
    }

    function buildIndices() {
      // Map sub-practice index to QA details
      for (const practiceKey of Object.keys(state.qas)) {
        const practiceEntry = state.qas[practiceKey];
        if (!practiceEntry || !practiceEntry.qas) continue;
        for (const [subName, details] of Object.entries(practiceEntry.qas)) {
          if (!details || !details.index) continue;
          state.qasByIndex.set(details.index, {
            name: subName,
            qas: details.QAs || {}
          });
        }
      }

      // Map sub-practice index to tools list
      state.tools.forEach(entry => {
        if (!entry || !entry.index) return;
        state.toolsByIndex.set(entry.index, entry.tools || []);
      });
    }

    function renderStats() {
      const hpCount = Object.keys(state.practices).length;
      let subCount = 0;
      const qaNames = new Set();
      const toolNames = new Set();

      Object.values(state.practices).forEach(practice => {
        if (!practice.sub_practices) return;
        practice.sub_practices.forEach(sub => {
          subCount += 1;
          const qaEntry = state.qasByIndex.get(sub.index);
          if (qaEntry && qaEntry.qas) {
            Object.keys(qaEntry.qas).forEach(name => qaNames.add(name));
          }
          const tools = state.toolsByIndex.get(sub.index) || [];
          tools.forEach(tool => toolNames.add(tool.name));
        });
      });

      document.getElementById('hp-count').textContent = hpCount;
      document.getElementById('subpractice-count').textContent = subCount;
      document.getElementById('tool-count').textContent = toolNames.size;
      document.getElementById('qa-count').textContent = qaNames.size;
    }

    function renderLayers() {
      layersContainer.innerHTML = '';
      state.layers.forEach(layer => {
        const section = document.createElement('section');
        section.className = 'layers-section';
        const heading = document.createElement('h2');
        heading.textContent = layer.layer;
        section.appendChild(heading);

        const grid = document.createElement('div');
        grid.className = 'hp-grid';

        layer.practices.forEach(practiceMeta => {
          const hpCard = document.createElement('div');
          hpCard.className = 'hp-card';
          hpCard.dataset.hpId = practiceMeta.id;
          hpCard.setAttribute('tabindex', '0');

          const cardButton = document.createElement('button');
          cardButton.className = 'hp-toggle';
          cardButton.type = 'button';

          const title = document.createElement('h3');
          title.className = 'hp-title';
          title.textContent = practiceMeta.name;

          const subCount = state.practices[practiceMeta.id]?.sub_practices?.length || 0;
          const meta = document.createElement('div');
          meta.className = 'hp-meta';
          meta.textContent = `${subCount} sub-practice${subCount !== 1 ? 's' : ''}`;

          cardButton.appendChild(title);
          cardButton.appendChild(meta);

          cardButton.addEventListener('click', event => {
            event.stopPropagation();
            toggleSubPractices(hpCard, practiceMeta.id);
          });

          hpCard.addEventListener('keypress', event => {
            if (event.key === 'Enter' || event.key === ' ') {
              event.preventDefault();
              toggleSubPractices(hpCard, practiceMeta.id);
            }
          });

          hpCard.appendChild(cardButton);
          grid.appendChild(hpCard);
        });

        section.appendChild(grid);
        layersContainer.appendChild(section);
      });
    }

    function toggleSubPractices(cardEl, hpId) {
      const existing = cardEl.querySelector('.subpractice-list');
      const allLists = layersContainer.querySelectorAll('.subpractice-list');
      if (existing) {
        existing.remove();
        cardEl.classList.remove('expanded');
        return;
      }

      allLists.forEach(list => list.remove());
      layersContainer.querySelectorAll('.hp-card.expanded').forEach(card => card.classList.remove('expanded'));

      const subList = document.createElement('div');
      subList.className = 'subpractice-list';

      const practice = state.practices[hpId];
      if (!practice || !practice.sub_practices) {
        const empty = document.createElement('p');
        empty.textContent = 'No sub-practices documented yet.';
        empty.className = 'sub-desc';
        subList.appendChild(empty);
      } else {
        practice.sub_practices.forEach(sub => {
          const subItem = document.createElement('div');
          subItem.className = 'sub-item';

          const button = document.createElement('button');
          button.type = 'button';
          button.addEventListener('click', event => {
            event.stopPropagation();
            openSubPracticeModal(sub, practice.name);
          });

          const headline = document.createElement('div');
          headline.className = 'sub-headline';

          const pill = document.createElement('span');
          pill.className = 'index-pill';
          pill.textContent = sub.index || '—';

          const name = document.createElement('span');
          name.textContent = sub.name;

          headline.appendChild(pill);
          headline.appendChild(name);

          if (sub.optional) {
            const optional = document.createElement('span');
            optional.className = 'optional-tag';
            optional.textContent = 'Optional';
            headline.appendChild(optional);
          }

          const desc = document.createElement('p');
          desc.className = 'sub-desc';
          desc.textContent = sub.description || 'No description available yet.';

          button.appendChild(headline);
          button.appendChild(desc);
          subItem.appendChild(button);
          subList.appendChild(subItem);
        });
      }

      cardEl.appendChild(subList);
      cardEl.classList.add('expanded');
    }

    function openSubPracticeModal(sub, hpName) {
      const modal = document.getElementById('subpractice-modal');
      const titleEl = document.getElementById('modal-title');
      const descEl = document.getElementById('modal-description');
      const indexEl = document.getElementById('modal-index');
      const qaSection = document.getElementById('modal-qas-section');
      const qaList = document.getElementById('modal-qas');
      const toolsSection = document.getElementById('modal-tools-section');
      const toolsList = document.getElementById('modal-tools');

      titleEl.textContent = sub.name;
      indexEl.textContent = `${sub.index} · ${hpName}`;
      descEl.textContent = sub.description || 'No description documented yet.';

      qaList.innerHTML = '';
      const qaData = state.qasByIndex.get(sub.index);
      const qas = qaData?.qas;
      if (qas && Object.keys(qas).length) {
        Object.entries(qas).forEach(([qaName, rationale]) => {
          const qaItem = document.createElement('div');
          qaItem.className = 'qa-item';

          const nameEl = document.createElement('div');
          nameEl.className = 'qa-name';
          nameEl.textContent = qaName;

          const rationaleEl = document.createElement('div');
          rationaleEl.className = 'qa-rationale';
          rationaleEl.textContent = rationale;

          qaItem.appendChild(nameEl);
          qaItem.appendChild(rationaleEl);
          qaList.appendChild(qaItem);
        });
        qaSection.style.display = '';
      } else {
        qaSection.style.display = 'none';
      }

      toolsList.innerHTML = '';
      const tools = state.toolsByIndex.get(sub.index) || [];
      if (tools.length) {
        tools.forEach(tool => {
          const item = document.createElement('div');
          item.className = 'tool-item';

          const link = document.createElement('a');
          link.href = tool.url || '#';
          link.target = '_blank';
          link.rel = 'noopener';
          link.textContent = tool.name;

          const ref = document.createElement('div');
          ref.className = 'tool-ref';
          ref.textContent = tool.acm_reference || '';

          item.appendChild(link);
          if (tool.acm_reference) {
            item.appendChild(ref);
          }
          toolsList.appendChild(item);
        });
        toolsSection.style.display = '';
      } else {
        toolsSection.style.display = 'none';
      }

      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      const modal = document.getElementById('subpractice-modal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }

    document.getElementById('modal-close').addEventListener('click', closeModal);
    document.getElementById('subpractice-modal').addEventListener('click', event => {
      if (event.target === event.currentTarget) {
        closeModal();
      }
    });

    document.addEventListener('keydown', event => {
      if (event.key === 'Escape') {
        const modal = document.getElementById('subpractice-modal');
        if (modal.classList.contains('active')) {
          closeModal();
        }
      }
    });

    loadData();
  </script>
</body>
</html>
